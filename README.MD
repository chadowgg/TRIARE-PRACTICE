# üÉè Durak Online Development Plan

**Tech Stack:**
- **Frontend:** React (Vite), TypeScript, TailwindCSS, shadcn/ui.
- **Backend:** NestJS, TypeScript, Socket.io (Websockets), Passport.js (OAuth).
- **Database:** MongoDB (Mongoose/Prisma).
- **State Management:** Zustand.

---

## üèõ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

**Flow –≤—Ö–æ–¥—É:**
1.  –ö–ª—ñ—î–Ω—Ç (React) –Ω–∞—Ç–∏—Å–∫–∞—î "–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google".
2.  –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –±–µ–∫–µ–Ω–¥—É (`/api/auth/google`).
3.  –ë–µ–∫–µ–Ω–¥ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É Google.
4.  –ü—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è Google –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –±–µ–∫–µ–Ω–¥ (`/api/auth/google/callback`).
5.  –ë–µ–∫–µ–Ω–¥ –ø–µ—Ä–µ–≤—ñ—Ä—è—î/—Å—Ç–≤–æ—Ä—é—î —é–∑–µ—Ä–∞ –≤ MongoDB, –≥–µ–Ω–µ—Ä—É—î **JWT** (access token).
6.  –ë–µ–∫–µ–Ω–¥ —Ä–æ–±–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∑ —Ç–æ–∫–µ–Ω–æ–º (—á–µ—Ä–µ–∑ URL query –∞–±–æ httpOnly cookie).

---

## üìÖ –ï—Ç–∞–ø 1: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –¢–∏–ø–∏ (–ë–µ–∑ –∑–º—ñ–Ω)

- [ ] **–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Monorepo** (–∞–±–æ structure).
- [ ] **Shared DTOs:** `ICard`, `IGameState`, `IPlayer`.

---

## üîê –ï—Ç–∞–ø 2: Backend - OAuth2 —Ç–∞ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

–ó–∞–º—ñ—Å—Ç—å —Ö–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó Passport.

- [ ] **–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—ñ–≤ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤:**
  - **Google Cloud Console:** –û—Ç—Ä–∏–º–∞—Ç–∏ `CLIENT_ID` —Ç–∞ `CLIENT_SECRET`. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ redirect URI.
  - **Discord Developer Portal:** –û—Ç—Ä–∏–º–∞—Ç–∏ ID —Ç–∞ Secret.
- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è MongoDB (User Schema):**
  - `email`: string (unique).
  - `provider`: 'google' | 'discord'.
  - `providerId`: string (ID –≤—ñ–¥ –≥—É–≥–ª–∞/–¥—ñ—Å–∫–æ—Ä–¥–∞).
  - `nickname`: string (–±–µ—Ä–µ–º–æ –∑ –ø—Ä–æ—Ñ—ñ–ª—é OAuth, –∞–ª–µ –¥–∞—î–º–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–º—ñ–Ω–∏—Ç–∏).
  - `avatarUrl`: string.
  - `stats`: { wins: 0, loses: 0, ... }.
  - *–ü—Ä–∏–º—ñ—Ç–∫–∞: –ü–æ–ª–µ `password` –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–µ.*
- [ ] **NestJS Auth Module:**
  - [ ] –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `@nestjs/passport`, `passport-google-oauth20`, `passport-discord`.
  - [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `GoogleStrategy` —Ç–∞ `DiscordStrategy`.
  - [ ] –ú–µ—Ç–æ–¥ `validateOAuthLogin`: –ó–Ω–∞—Ö–æ–¥–∏—Ç—å —é–∑–µ—Ä–∞ –∑–∞ `providerId` –∞–±–æ —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–æ–≥–æ.
  - [ ] –ï–Ω–¥–ø–æ—ñ–Ω—Ç `GET /auth/google` -> Guard -> Redirect.
  - [ ] –ï–Ω–¥–ø–æ—ñ–Ω—Ç `GET /auth/google/callback` -> –û—Ç—Ä–∏–º—É—î –ø—Ä–æ—Ñ—ñ–ª—å -> –ì–µ–Ω–µ—Ä—É—î JWT.
  - [ ] **–í–∞–∂–ª–∏–≤–æ:** –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –ø–µ—Ä–µ–¥–∞—á—ñ JWT –Ω–∞ –∫–ª—ñ—î–Ω—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `http://localhost:5173/auth-success?token=xyz`).

---

## üéÆ –ï—Ç–∞–ø 3: Backend - Game Core

–ü–∏—à–µ–º–æ –¥–≤–∏–≥—É–Ω –≥—Ä–∏ –±–µ–∑ –ø—Ä–∏–≤'—è–∑–∫–∏ –¥–æ —Å–æ–∫–µ—Ç—ñ–≤. –¶–µ –ø—Ä–æ—Å—Ç–æ –∫–ª–∞—Å–∏ TS.

- [ ] **–ö–ª–∞—Å `Deck`:** –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è 36/52 –∫–∞—Ä—Ç, –ø–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è (`shuffle`), —Ä–æ–∑–¥–∞—á–∞.
- [ ] **–ö–ª–∞—Å `DurakGame`:**
  - –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –ø–∞—Ä—Ç—ñ—ó.
  - –ú–µ—Ç–æ–¥ `joinPlayer(user)` / `leavePlayer(userId)`.
  - –ú–µ—Ç–æ–¥ `attack(userId, card)`: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∞–ª—ñ–¥–Ω–æ—Å—Ç—ñ (—á–∏ —î –∫–∞—Ä—Ç–∞, —á–∏ –º–æ–∂–Ω–∞ –ø—ñ–¥–∫–∏–¥–∞—Ç–∏).
  - –ú–µ—Ç–æ–¥ `defend(userId, attackCard, defendCard)`: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –±'—î –∫–∞—Ä—Ç–∞.
  - –ú–µ—Ç–æ–¥ `take(userId)`: –ì—Ä–∞–≤–µ—Ü—å –∑–∞–±–∏—Ä–∞—î –∫–∞—Ä—Ç–∏ –∑—ñ —Å—Ç–æ–ª—É.
  - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–º–æ–≤ –ø–µ—Ä–µ–º–æ–≥–∏/–ø—Ä–æ–≥—Ä–∞—à—É.

---

## üîå –ï—Ç–∞–ø 4: Backend - WebSockets & Lobby

–°–æ–∫–µ—Ç–∏ —Ç–∞–∫–æ–∂ –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞—Ö–∏—â–µ–Ω—ñ, –∞–ª–µ —Ç–µ–ø–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å JWT, –æ—Ç—Ä–∏–º–∞–Ω–∏–π —á–µ—Ä–µ–∑ OAuth.

- [ ] **Socket Auth Middleware:**
  - –ü—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ (`handleConnection`) –¥—ñ—Å—Ç–∞–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω –∑ `handshake.auth.token` –∞–±–æ cookies.
  - –í–∞–ª—ñ–¥—É–≤–∞—Ç–∏ JWT, –ø—Ä–∏–∫—Ä—ñ–ø–ª—è—Ç–∏ `user` –¥–æ —Å–æ–∫–µ—Ç–∞.
- [ ] **Lobby Manager (Service):**
  - –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–∏—Ö —ñ–≥–æ—Ä —É –ø–∞–º'—è—Ç—ñ (Map `lobbyId` -> `DurakGame instance`).
  - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è **Invite Codes** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `AG45B` -> –º–∞–ø–∏—Ç—å—Å—è –Ω–∞ `UUID` –∫—ñ–º–Ω–∞—Ç–∏).
- [ ] **Game Gateway (`@WebSocketGateway`):**
  - `handleConnection`: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ –∑ handshake.
  - Event `create_lobby`: –°—Ç–≤–æ—Ä—é—î –≥—Ä—É, –ø–æ–≤–µ—Ä—Ç–∞—î `lobbyId` —Ç–∞ `inviteCode`.
  - Event `join_lobby`: –ü—Ä–∏–π–º–∞—î –∫–æ–¥, –¥–æ–¥–∞—î —Å–æ–∫–µ—Ç —É –∫—ñ–º–Ω–∞—Ç—É `socket.join(lobbyId)`.
  - Event `player_action`: –û—Ç—Ä–∏–º—É—î —Ö—ñ–¥, –≤–∏–∫–ª–∏–∫–∞—î –º–µ—Ç–æ–¥ `DurakGame`, –µ–º—ñ—Ç–∏—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–µ–π—Ç.
- [ ] **–û–±—Ä–æ–±–∫–∞ —Ä–æ–∑—Ä–∏–≤—É –∑'—î–¥–Ω–∞–Ω–Ω—è:**
  - –¢–∞–π–º–µ—Ä –Ω–∞ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 30 —Å–µ–∫), —ñ–Ω–∞–∫—à–µ —Ç–µ—Ö. –ø–æ—Ä–∞–∑–∫–∞.

---

## üñ• –ï—Ç–∞–ø 5: Frontend - UI & OAuth Integration

- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Routing:**
  - `/login`, `/register`
  - `/` (Dashboard: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∫–Ω–æ–ø–∫–∞ "–°—Ç–≤–æ—Ä–∏—Ç–∏", –∫–Ω–æ–ø–∫–∞ "–£–≤—ñ–π—Ç–∏ –∑–∞ –∫–æ–¥–æ–º").
  - `/game/:id` (–°–∞–º–µ —ñ–≥—Ä–æ–≤–µ –ø–æ–ª–µ).
- [ ] **UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ (Shadcn):**
  - –§–æ—Ä–º–∏ –≤—Ö–æ–¥—É/—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó.
  - –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –Ü–Ω–≤–∞–π—Ç-–∫–æ–¥—É.
  - **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –≥—Ä–∏:**
    - `PlayingCard`: –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏ (–º–æ–∂–Ω–∞ –≤–∑—è—Ç–∏ –≥–æ—Ç–æ–≤—ñ SVG –∞—Å–µ—Ç–∏).
    - `GameBoard`: —Å—Ç—ñ–ª, –¥–µ –ª–µ–∂–∞—Ç—å –∫–∞—Ä—Ç–∏.
    - `PlayerAvatar`: –∑ —Ç–∞–π–º–µ—Ä–æ–º —Ö–æ–¥—É.
- [ ] **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è WebSocket:**
  - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ö—É–∫–∞ `useGameSocket`.
  - –°–ª—É—Ö–∞–Ω–Ω—è –ø–æ–¥—ñ–π: `game_started`, `update_state`, `player_error`.
  - –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞–Ω—É: "–Ø–∫—â–æ `myTurn === true`, –ø—ñ–¥—Å–≤—ñ—Ç–∏—Ç–∏ –º–æ—ó –∫–∞—Ä—Ç–∏".
- [ ] **–°—Ç–æ—Ä—ñ–Ω–∫–∞ –í—Ö–æ–¥—É (`/login`):**
  - –ó–∞–º—ñ—Å—Ç—å —Ñ–æ—Ä–º–∏ ‚Äî –¥–≤—ñ –∫—Ä–∞—Å–∏–≤—ñ –∫–Ω–æ–ø–∫–∏ (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ shadcn/ui `Button` –∑ —ñ–∫–æ–Ω–∫–∞–º–∏):
    - `[G] Continue with Google`
    - `[D] Continue with Discord`
  - –ö–ª—ñ–∫ –ø–æ –∫–Ω–æ–ø—Ü—ñ –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î `http://localhost:3000/api/auth/google`.
- [ ] **–°—Ç–æ—Ä—ñ–Ω–∫–∞ –æ–±—Ä–æ–±–∫–∏ –≤—Ö–æ–¥—É (`/auth-success`):**
  - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏: –õ–æ–∞–¥–µ—Ä "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è...".
  - `useEffect`: –ó—á–∏—Ç—É—î —Ç–æ–∫–µ–Ω –∑ URL (`?token=...`), –∑–±–µ—Ä—ñ–≥–∞—î –π–æ–≥–æ –≤ `localStorage` (–∞–±–æ Zustand store) —ñ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ `/` (Dashboard).
- [ ] **Dashboard:**
  - –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∞ —Ç–∞ –Ω—ñ–∫–Ω–µ–π–º—É, –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö –≤—ñ–¥ Google/Discord.
- [ ] **–ì—Ä–∞:**
  - –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–æ–∫–µ—Ç–∞ –∑ –ø–µ—Ä–µ–¥–∞—á–µ—é —Ç–æ–∫–µ–Ω–∞.
- React –¥–æ–¥–∞—Ç–æ–∫ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º shadcn/ui.

---

## üöÄ –ï—Ç–∞–ø 6: –§—ñ—á—ñ —Ç–∞ –ü–æ–ª—ñ—à–∏–Ω–≥

- [ ] **–ó–º—ñ–Ω–∞ –Ω—ñ–∫–Ω–µ–π–º—É:** –û—Å–∫—ñ–ª—å–∫–∏ OAuth —á–∞—Å—Ç–æ –¥–∞—î —Å–ø—Ä–∞–≤–∂–Ω—ñ —ñ–º–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "Vasyl Pupkin"), —Ç—Ä–µ–±–∞ –¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —é–∑–µ—Ä—É –æ–¥–∏–Ω —Ä–∞–∑ –∑–º—ñ–Ω–∏—Ç–∏ –Ω—ñ–∫ –Ω–∞ —ñ–≥—Ä–æ–≤–∏–π ("Nagibator2000").
- [ ] **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–∞–≤–∏–ª:** –ü—ñ–¥–∫–∏–¥–Ω–∏–π, –ü–µ—Ä–µ–≤—ñ–¥–Ω–∏–π (–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –ª–æ–±–±—ñ).
- [ ] **–ê–Ω—ñ–º–∞—Ü—ñ—ó:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `Framer Motion` –¥–ª—è —Ä—É—Ö—É –∫–∞—Ä—Ç (—Ä–æ–∑–¥–∞—á–∞, —Ö—ñ–¥, –±–∏—Ç–æ).
- [ ] **–¢–∞–π–º–µ—Ä–∏ —Ö–æ–¥—É:** –ù–∞ –±–µ–∫–µ–Ω–¥—ñ (—â–æ–± –Ω–µ —á–∏—Ç–µ—Ä–∏–ª–∏) + –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç—ñ.
- [ ] **–ß–∞—Ç —É –ª–æ–±–±—ñ:** –ü—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π —á–∞—Ç.